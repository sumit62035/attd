<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Dashboard - SIH</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Heroicons for Bell Icon -->
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- Topbar -->
  <div class="flex items-center justify-between bg-white shadow p-4 relative">
    <h1 class="text-xl font-bold">Student Dashboard</h1>
    <div class="flex gap-4 items-center">
      <!-- Bell Icon -->
      <button onclick="toggleNotifications()" class="relative">
        <i data-feather="bell" class="w-6 h-6"></i>
      </button>

      <!-- Notifications Popup -->
      <div id="notificationBox" class="hidden absolute right-4 top-12 bg-white shadow-lg rounded w-64 p-3">
        <div class="flex items-center justify-between mb-2">
          <h4 class="font-semibold">Notifications</h4>
          <button onclick="markAllRead()" class="text-xs text-indigo-600 hover:underline">Mark all as read</button>
        </div>
        <ul id="notifList" class="text-sm text-gray-600 space-y-2">
          <li>‚úÖ Attendance marked for Data Structures</li>
          <li>‚ö†Ô∏è 2 absences in Web Designing</li>
          <li>üì¢ College fest starts next week!</li>
        </ul>
      </div>

      <!-- Date Range Filter -->
      <div class="flex gap-2">
        <select id="rangeSelect" onchange="updateCharts()" class="px-2 py-1 border rounded">
          <option value="7">Last 7 Days</option>
          <option value="28">Last 28 Days</option>
          <option value="custom">Custom Range</option>
        </select>
        <input type="date" id="startDate" class="px-2 py-1 border rounded hidden" />
        <input type="date" id="endDate" class="px-2 py-1 border rounded hidden" />
        <button onclick="applyCustomRange()" id="applyBtn" class="px-3 py-1 bg-indigo-600 text-white rounded hidden">Apply</button>
      </div>
    </div>
  </div>

  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r p-4 h-screen">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-full bg-indigo-600 text-white flex items-center justify-center text-xl font-bold">A</div>
        <div>
          <div class="font-semibold">sumit Kumar</div>
          <div class="text-xs text-gray-500">CSE24-28</div>
        </div>
      </div>
      <nav class="flex flex-col gap-2">
        <button class="text-left px-3 py-2 rounded bg-indigo-100 text-indigo-700 font-semibold">üìä Dashboard</button>
        <button class="text-left px-3 py-2 rounded hover:bg-gray-100">üóÇ Attendance</button>
        <button class="text-left px-3 py-2 rounded hover:bg-gray-100">üìà Analytics</button>
        <button class="text-left px-3 py-2 rounded hover:bg-gray-100">üìù Complaints</button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 space-y-6">
      <!-- Overview Section -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- College Details -->
        <div class="bg-white p-4 rounded shadow">
          <div class="text-sm text-gray-500">College Details</div>
          <div class="text-lg font-semibold">Bakhtiyarpur College of Engineering</div>
          <div class="text-xs text-gray-500">B.Tech CSE - 2nd Semester</div>
        </div>
        <!-- Overall Attendance -->
        <div class="bg-white p-4 rounded shadow">
          <div class="text-sm text-gray-500">Overall Attendance</div>
          <div class="text-2xl font-bold" id="overallPercent">88%</div>
          <div class="text-xs text-gray-400">84 of 96 days</div>
        </div>
      </div>

      <!-- Subject-wise Chart + Last 5 Attendance -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Subject Bar Graph -->
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold mb-2">Subject-wise Attendance (%)</h3>
          <canvas id="subjectBar"></canvas>
        </div>

        <!-- Last 5 Attendance Table -->
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold mb-2">Last 5 Classes</h3>
          <table class="w-full text-left text-sm">
            <thead>
              <tr class="border-b text-gray-500">
                <th>Date</th>
                <th>Subject</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="lastFiveTable">
              <!-- Filled by JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Complaint Section -->
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-3">Raise a Complaint</h3>
        <div class="flex gap-2 mb-3">
          <input id="complaintInput" type="text" placeholder="Type your complaint..." 
                 class="flex-1 px-3 py-2 border rounded"/>
          <button onclick="submitComplaint()" class="px-3 py-2 bg-indigo-600 text-white rounded">
            Submit
          </button>
        </div>
        <ul id="complaintList" class="list-disc pl-6 text-sm text-gray-700"></ul>
      </div>

      <!-- QR Scan Simulation Section -->
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-3">Scan QR Code</h3>
        <button onclick="openScanModal()" class="px-3 py-2 bg-green-600 text-white rounded">
          Open Scanner
        </button>
      </div>
    </main>
  </div>

  <!-- QR Scanner Modal -->
  <div id="scanModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center">
    <div class="bg-white p-6 rounded shadow w-96 text-center">
      <h4 class="font-semibold mb-3">QR Scanner</h4>
      <div class="w-full h-48 bg-gray-900 flex items-center justify-center text-white">
        üì∑ Camera View (Simulated)
      </div>
      <button onclick="simulateScan()" class="mt-4 px-3 py-2 bg-green-600 text-white rounded">
        Scan Now
      </button>
      <button onclick="closeScanModal()" class="mt-2 px-3 py-2 border rounded">
        Close
      </button>
      <div id="scanResult" class="mt-3 text-sm"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // ---------- Mock Data ----------
    const subjects = ["Data Structures", "Web Designing", "Maths", "English"];
    const subjectPercent = [92, 75, 83, 100]; // percentage
    const lastFive = [
      { date: "2025-09-12", subject: "Data Structures", status: "Present" },
      { date: "2025-09-11", subject: "Web Designing", status: "Absent" },
      { date: "2025-09-10", subject: "Maths", status: "Present" },
      { date: "2025-09-09", subject: "English", status: "Present" },
      { date: "2025-09-08", subject: "Data Structures", status: "Absent" },
    ];

    let subjectChart;

    // ---------- Render Subject Chart ----------
    function renderCharts() {
      if (subjectChart) subjectChart.destroy();
      subjectChart = new Chart(document.getElementById("subjectBar"), {
        type: "bar",
        data: {
          labels: subjects,
          datasets: [{
            label: "Attendance %",
            data: subjectPercent,
            backgroundColor: ["#6366f1", "#06b6d4", "#f97316", "#10b981"]
          }]
        },
        options: { scales: { y: { beginAtZero: true, max: 100 } } }
      });

      // Fill last 5 attendance table
      const tbody = document.getElementById("lastFiveTable");
      tbody.innerHTML = "";
      lastFive.forEach(r => {
        const tr = document.createElement("tr");
        tr.classList.add("border-b");
        tr.innerHTML = `
          <td class="py-1">${r.date}</td>
          <td class="py-1">${r.subject}</td>
          <td class="py-1 ${r.status === "Present" ? "text-green-600" : "text-red-600"} font-medium">
            ${r.status}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ---------- Complaint Logic ----------
    function submitComplaint() {
      const input = document.getElementById("complaintInput");
      const list = document.getElementById("complaintList");
      if (!input.value.trim()) return alert("Please write a complaint!");
      const li = document.createElement("li");
      li.textContent = input.value;
      list.appendChild(li);
      input.value = "";
    }

    // ---------- QR Scan Logic ----------
    function openScanModal() {
      document.getElementById("scanModal").classList.remove("hidden");
      document.getElementById("scanModal").classList.add("flex");
    }
    function closeScanModal() {
      document.getElementById("scanModal").classList.add("hidden");
      document.getElementById("scanResult").innerText = "";
    }
    function simulateScan() {
      document.getElementById("scanResult").innerText = "‚úÖ QR Scanned Successfully (Simulated)";
    }

    // ---------- Notification Logic ----------
    function toggleNotifications() {
      const box = document.getElementById("notificationBox");
      box.classList.toggle("hidden");
    }
    function markAllRead() {
      document.getElementById("notifList").innerHTML = "<li class='text-gray-400'>No new notifications</li>";
    }

    // ---------- Date Range Logic ----------
    function updateCharts() {
      const val = document.getElementById("rangeSelect").value;
      if (val === "custom") {
        document.getElementById("startDate").classList.remove("hidden");
        document.getElementById("endDate").classList.remove("hidden");
        document.getElementById("applyBtn").classList.remove("hidden");
      } else {
        document.getElementById("startDate").classList.add("hidden");
        document.getElementById("endDate").classList.add("hidden");
        document.getElementById("applyBtn").classList.add("hidden");
        renderCharts();
      }
    }
    function applyCustomRange() {
      const start = document.getElementById("startDate").value;
      const end = document.getElementById("endDate").value;
      if (!start || !end) return alert("Please select both dates!");
      alert(`Showing data from ${start} to ${end} (prototype - same mock chart shown).`);
      renderCharts();
    }

    // ---------- Initial Load ----------
    renderCharts();
    feather.replace(); // icons
  </script>
</body>
</html>
